import os from "os";
import { GithubActionLogger } from "./external/github-action-logger";
import { ZodValidatorAdapter } from "./lib/adapters/zod-validator-adapter";
import { GithubActionIO } from "./external/github-action-i-o";
import { IoInputRetriever } from "./lib/adapters/io-input-retriever";
import { setFailed } from "@actions/core";
import { historyEntry, history } from "./lib/input";
import { SimpleRenderService } from "./lib/simple-render-service";
import { SimpleTableGenerator } from "./lib/simple-table-generator";
import { Kore } from "@kirinnee/core";
import { App } from "./lib/main";
import { stringToOption } from "./lib/util";
import { CodeQualityReportConverter } from "./lib/converter/code-quality-report-converter";
import { DocumentationConverter } from "./lib/converter/documentation-converter";
import { TestResultConverter } from "./lib/converter/test-result-converter";
import { TestCoverageConverter } from "./lib/converter/test-coverage-converter";
const core = new Kore();
core.ExtendPrimitives();
const log = new GithubActionLogger();
const historyValidator = new ZodValidatorAdapter(history);
const historyEntryValidator = new ZodValidatorAdapter(historyEntry);
const io = new GithubActionIO();
const input = new IoInputRetriever(io, historyEntryValidator, historyValidator);
const converters = [
    new CodeQualityReportConverter(),
    new DocumentationConverter(),
    new TestResultConverter(),
    new TestCoverageConverter(),
];
const tableGen = new SimpleTableGenerator(converters, core);
const service = new SimpleRenderService(converters, tableGen);
const app = new App(input, service, io);
await app.run().match({
    none: () => {
        log.info("✅ Successfully extracted metadata");
    },
    some: async (errs) => {
        log.error("❌ Failed to extract metadata");
        for (const err of errs) {
            setFailed(err);
            const messages = await stringToOption(err?.stack).match({
                none: ["❌ No stacktrace found!"],
                some: (stacktrace) => stacktrace.split(os.EOL),
            });
            for (const m of messages) {
                log.error(m);
            }
        }
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLElBQUksQ0FBQztBQUNwQixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQztBQUNyRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxzQ0FBc0MsQ0FBQztBQUMzRSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDOUQsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDckUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMxQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUNwRCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNsRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNwRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFdEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUNqQyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzVDLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLCtDQUErQyxDQUFDO0FBQzNGLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQ2pGLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLHVDQUF1QyxDQUFDO0FBQzVFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBRWhGLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7QUFDeEIsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7QUFDeEIsTUFBTSxHQUFHLEdBQUcsSUFBSSxrQkFBa0IsRUFBRSxDQUFDO0FBQ3JDLE1BQU0sZ0JBQWdCLEdBQUcsSUFBSSxtQkFBbUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMxRCxNQUFNLHFCQUFxQixHQUFHLElBQUksbUJBQW1CLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDcEUsTUFBTSxFQUFFLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztBQUNoQyxNQUFNLEtBQUssR0FBRyxJQUFJLGdCQUFnQixDQUFDLEVBQUUsRUFBRSxxQkFBcUIsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO0FBQ2hGLE1BQU0sVUFBVSxHQUFnQjtJQUM5QixJQUFJLDBCQUEwQixFQUFFO0lBQ2hDLElBQUksc0JBQXNCLEVBQUU7SUFDNUIsSUFBSSxtQkFBbUIsRUFBRTtJQUN6QixJQUFJLHFCQUFxQixFQUFFO0NBQzVCLENBQUM7QUFDRixNQUFNLFFBQVEsR0FBRyxJQUFJLG9CQUFvQixDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsQ0FBQztBQUM1RCxNQUFNLE9BQU8sR0FBRyxJQUFJLG1CQUFtQixDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztBQUM5RCxNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBRXhDLE1BQU0sR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDLEtBQUssQ0FBQztJQUNwQixJQUFJLEVBQUUsR0FBRyxFQUFFO1FBQ1QsR0FBRyxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFDRCxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxFQUFFO1FBQ25CLEdBQUcsQ0FBQyxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQztRQUMxQyxLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksRUFBRTtZQUN0QixTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDZixNQUFNLFFBQVEsR0FBRyxNQUFNLGNBQWMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDO2dCQUN0RCxJQUFJLEVBQUUsQ0FBQyx3QkFBd0IsQ0FBQztnQkFDaEMsSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUM7YUFDL0MsQ0FBQyxDQUFDO1lBQ0gsS0FBSyxNQUFNLENBQUMsSUFBSSxRQUFRLEVBQUU7Z0JBQ3hCLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDZDtTQUNGO0lBQ0gsQ0FBQztDQUNGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBvcyBmcm9tIFwib3NcIjtcbmltcG9ydCB7IEdpdGh1YkFjdGlvbkxvZ2dlciB9IGZyb20gXCIuL2V4dGVybmFsL2dpdGh1Yi1hY3Rpb24tbG9nZ2VyXCI7XG5pbXBvcnQgeyBab2RWYWxpZGF0b3JBZGFwdGVyIH0gZnJvbSBcIi4vbGliL2FkYXB0ZXJzL3pvZC12YWxpZGF0b3ItYWRhcHRlclwiO1xuaW1wb3J0IHsgR2l0aHViQWN0aW9uSU8gfSBmcm9tIFwiLi9leHRlcm5hbC9naXRodWItYWN0aW9uLWktb1wiO1xuaW1wb3J0IHsgSW9JbnB1dFJldHJpZXZlciB9IGZyb20gXCIuL2xpYi9hZGFwdGVycy9pby1pbnB1dC1yZXRyaWV2ZXJcIjtcbmltcG9ydCB7IHNldEZhaWxlZCB9IGZyb20gXCJAYWN0aW9ucy9jb3JlXCI7XG5pbXBvcnQgeyBoaXN0b3J5RW50cnksIGhpc3RvcnkgfSBmcm9tIFwiLi9saWIvaW5wdXRcIjtcbmltcG9ydCB7IFNpbXBsZVJlbmRlclNlcnZpY2UgfSBmcm9tIFwiLi9saWIvc2ltcGxlLXJlbmRlci1zZXJ2aWNlXCI7XG5pbXBvcnQgeyBTaW1wbGVUYWJsZUdlbmVyYXRvciB9IGZyb20gXCIuL2xpYi9zaW1wbGUtdGFibGUtZ2VuZXJhdG9yXCI7XG5pbXBvcnQgeyBLb3JlIH0gZnJvbSBcIkBraXJpbm5lZS9jb3JlXCI7XG5pbXBvcnQgeyBDb252ZXJ0ZXIgfSBmcm9tIFwiLi9saWIvaW50ZXJmYWNlL2NvbnZlcnRlclwiO1xuaW1wb3J0IHsgQXBwIH0gZnJvbSBcIi4vbGliL21haW5cIjtcbmltcG9ydCB7IHN0cmluZ1RvT3B0aW9uIH0gZnJvbSBcIi4vbGliL3V0aWxcIjtcbmltcG9ydCB7IENvZGVRdWFsaXR5UmVwb3J0Q29udmVydGVyIH0gZnJvbSBcIi4vbGliL2NvbnZlcnRlci9jb2RlLXF1YWxpdHktcmVwb3J0LWNvbnZlcnRlclwiO1xuaW1wb3J0IHsgRG9jdW1lbnRhdGlvbkNvbnZlcnRlciB9IGZyb20gXCIuL2xpYi9jb252ZXJ0ZXIvZG9jdW1lbnRhdGlvbi1jb252ZXJ0ZXJcIjtcbmltcG9ydCB7IFRlc3RSZXN1bHRDb252ZXJ0ZXIgfSBmcm9tIFwiLi9saWIvY29udmVydGVyL3Rlc3QtcmVzdWx0LWNvbnZlcnRlclwiO1xuaW1wb3J0IHsgVGVzdENvdmVyYWdlQ29udmVydGVyIH0gZnJvbSBcIi4vbGliL2NvbnZlcnRlci90ZXN0LWNvdmVyYWdlLWNvbnZlcnRlclwiO1xuXG5jb25zdCBjb3JlID0gbmV3IEtvcmUoKTtcbmNvcmUuRXh0ZW5kUHJpbWl0aXZlcygpO1xuY29uc3QgbG9nID0gbmV3IEdpdGh1YkFjdGlvbkxvZ2dlcigpO1xuY29uc3QgaGlzdG9yeVZhbGlkYXRvciA9IG5ldyBab2RWYWxpZGF0b3JBZGFwdGVyKGhpc3RvcnkpO1xuY29uc3QgaGlzdG9yeUVudHJ5VmFsaWRhdG9yID0gbmV3IFpvZFZhbGlkYXRvckFkYXB0ZXIoaGlzdG9yeUVudHJ5KTtcbmNvbnN0IGlvID0gbmV3IEdpdGh1YkFjdGlvbklPKCk7XG5jb25zdCBpbnB1dCA9IG5ldyBJb0lucHV0UmV0cmlldmVyKGlvLCBoaXN0b3J5RW50cnlWYWxpZGF0b3IsIGhpc3RvcnlWYWxpZGF0b3IpO1xuY29uc3QgY29udmVydGVyczogQ29udmVydGVyW10gPSBbXG4gIG5ldyBDb2RlUXVhbGl0eVJlcG9ydENvbnZlcnRlcigpLFxuICBuZXcgRG9jdW1lbnRhdGlvbkNvbnZlcnRlcigpLFxuICBuZXcgVGVzdFJlc3VsdENvbnZlcnRlcigpLFxuICBuZXcgVGVzdENvdmVyYWdlQ29udmVydGVyKCksXG5dO1xuY29uc3QgdGFibGVHZW4gPSBuZXcgU2ltcGxlVGFibGVHZW5lcmF0b3IoY29udmVydGVycywgY29yZSk7XG5jb25zdCBzZXJ2aWNlID0gbmV3IFNpbXBsZVJlbmRlclNlcnZpY2UoY29udmVydGVycywgdGFibGVHZW4pO1xuY29uc3QgYXBwID0gbmV3IEFwcChpbnB1dCwgc2VydmljZSwgaW8pO1xuXG5hd2FpdCBhcHAucnVuKCkubWF0Y2goe1xuICBub25lOiAoKSA9PiB7XG4gICAgbG9nLmluZm8oXCLinIUgU3VjY2Vzc2Z1bGx5IGV4dHJhY3RlZCBtZXRhZGF0YVwiKTtcbiAgfSxcbiAgc29tZTogYXN5bmMgKGVycnMpID0+IHtcbiAgICBsb2cuZXJyb3IoXCLinYwgRmFpbGVkIHRvIGV4dHJhY3QgbWV0YWRhdGFcIik7XG4gICAgZm9yIChjb25zdCBlcnIgb2YgZXJycykge1xuICAgICAgc2V0RmFpbGVkKGVycik7XG4gICAgICBjb25zdCBtZXNzYWdlcyA9IGF3YWl0IHN0cmluZ1RvT3B0aW9uKGVycj8uc3RhY2spLm1hdGNoKHtcbiAgICAgICAgbm9uZTogW1wi4p2MIE5vIHN0YWNrdHJhY2UgZm91bmQhXCJdLFxuICAgICAgICBzb21lOiAoc3RhY2t0cmFjZSkgPT4gc3RhY2t0cmFjZS5zcGxpdChvcy5FT0wpLFxuICAgICAgfSk7XG4gICAgICBmb3IgKGNvbnN0IG0gb2YgbWVzc2FnZXMpIHtcbiAgICAgICAgbG9nLmVycm9yKG0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbn0pO1xuIl19